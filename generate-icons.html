<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•„ì´ì½˜ ìƒì„±ê¸°</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #6366f1;
      margin-bottom: 2rem;
    }
    .icon-preview {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 2rem 0;
    }
    .preview-item {
      text-align: center;
    }
    .preview-item img {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
    .preview-item p {
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: #6b7280;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    button:hover {
      background: #4f46e5;
    }
    .status {
      margin-top: 1rem;
      padding: 1rem;
      background: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
      color: #166534;
      display: none;
    }
    .status.show {
      display: block;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“± PWA ì•„ì´ì½˜ ìƒì„±ê¸°</h1>
    <p>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë‹¤ì–‘í•œ í¬ê¸°ì˜ ì•„ì´ì½˜ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>

    <div class="icon-preview" id="preview">
      <!-- ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>

    <button onclick="generateIcons()">ğŸ¨ ì•„ì´ì½˜ ìƒì„±</button>
    <div class="status" id="status"></div>

    <canvas id="canvas"></canvas>
  </div>

  <script>
    const sizes = [72, 96, 128, 144, 152, 192, 384, 512];

    async function loadSVG() {
      const response = await fetch('assets/icons/icon.svg');
      const svgText = await response.text();
      return svgText;
    }

    function svgToImage(svgText, size) {
      return new Promise((resolve) => {
        const img = new Image();
        const blob = new Blob([svgText], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);

        img.onload = () => {
          const canvas = document.getElementById('canvas');
          canvas.width = size;
          canvas.height = size;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, size, size);

          canvas.toBlob((blob) => {
            URL.revokeObjectURL(url);
            resolve(blob);
          }, 'image/png');
        };

        img.src = url;
      });
    }

    async function generateIcons() {
      const preview = document.getElementById('preview');
      const status = document.getElementById('status');

      preview.innerHTML = '<p>ìƒì„± ì¤‘...</p>';
      status.classList.remove('show');

      try {
        const svgText = await loadSVG();
        preview.innerHTML = '';

        for (const size of sizes) {
          const blob = await svgToImage(svgText, size);
          const url = URL.createObjectURL(blob);

          // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          previewItem.innerHTML = `
            <img src="${url}" width="${Math.min(size, 128)}" height="${Math.min(size, 128)}" alt="${size}x${size}">
            <p>${size}Ã—${size}</p>
          `;
          preview.appendChild(previewItem);

          // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
          const link = document.createElement('a');
          link.href = url;
          link.download = `icon-${size}x${size}.png`;
          link.click();

          await new Promise(resolve => setTimeout(resolve, 100));
        }

        status.textContent = `âœ… ${sizes.length}ê°œì˜ ì•„ì´ì½˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìš´ë¡œë“œ í´ë”ë¥¼ í™•ì¸í•˜ê³  assets/icons/ í´ë”ë¡œ ì´ë™í•´ì£¼ì„¸ìš”.`;
        status.classList.add('show');
      } catch (error) {
        status.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
        status.classList.add('show');
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¯¸ë¦¬ë³´ê¸°ë§Œ í‘œì‹œ
    window.addEventListener('load', async () => {
      const preview = document.getElementById('preview');
      const svgText = await loadSVG();

      for (const size of [72, 128, 192, 512]) {
        const blob = await svgToImage(svgText, size);
        const url = URL.createObjectURL(blob);

        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        previewItem.innerHTML = `
          <img src="${url}" width="${Math.min(size, 128)}" height="${Math.min(size, 128)}" alt="${size}x${size}">
          <p>${size}Ã—${size}</p>
        `;
        preview.appendChild(previewItem);
      }
    });
  </script>
</body>
</html>
